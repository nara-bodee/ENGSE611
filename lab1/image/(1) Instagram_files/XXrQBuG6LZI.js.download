;/*FB_PKG_DELIM*/

__d("FDSCrossFilled12PNGIcon.react",["ix","fbicon"],(function(t,n,r,o,a,i,l,s){"use strict";var e=o("fbicon")._(s("478231"),12),u=e;l.default=u}),98);
__d("WAGetUserMedia",[],(function(t,n,r,o,a,i){"use strict";function e(){var e=navigator.mediaDevices;return e==null?null:function(t){return e.getUserMedia(t)}}var l=e();i.getUserMedia=l}),66);
__d("WAPttComposerOpusRecorder",["$InternalEnum","Promise","WAGetUserMedia","WANullthrows","WAOpusRecorderWorkerClient","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){var e,s={bitRate:16e3,bufferLength:4096,numberOfChannels:1,encoderSampleRate:16e3,maxBuffersPerPage:40,encoderApplication:2048,encoderFrameSize:20,streamOptions:{optional:[],mandatory:{googEchoCancellation:!1,googAutoGainControl:!1,googNoiseSuppression:!1,googHighpassFilter:!1}}},u=n("$InternalEnum").Mirrored(["INACTIVE","RECORDING","PAUSED","STOPPED"]),c=(function(){function t(t){var o=this;if(this._duration=0,this._recordedPages=[],this._state=u.INACTIVE,this._isFirstBuffer=!1,this._requestCount=0,this._pendingFlushResolvers=new Map,this._handleEncoderMessage=function(e){var t=e.data;switch(t.message){case"page":o._storePage(t.page);break;case"flushed":o._handleFlushed(t.requestId);break;default:throw r("err")("Invalid message event type: "+t.message)}},!m())throw r("err")("Recording is not supported in this browser");this._createStream=t.createStream,this._onDuration=t.onDuration,this._onPause=t.onPause,this._onResume=t.onResume,this._onStart=t.onStart,this._onStop=t.onStop,this._handlePage=t.onPage,this._completeRecordingPromise=new(e||(e=n("Promise")))(function(e){o._resolveCompleteRecordingPromise=e}),this._audioContext=new AudioContext,this._encoderNode=this._audioContext.createScriptProcessor(s.bufferLength,s.numberOfChannels,s.numberOfChannels),this._encoderNode.onaudioprocess=function(e){o._encodeBuffers(e.inputBuffer)},this._monitorNode=this._audioContext.createGain()}var a=t.prototype;return a.getState=function(){return this._state},a.start=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e,t;switch(this._state){case u.RECORDING:return!0;case u.STOPPED:return!1;case u.PAUSED:return this.resume();case u.INACTIVE:break}this._recordedPages=[],this._isFirstBuffer=!0,this._duration=0;var n=o("WAOpusRecorderWorkerClient").getOpusEncoderWorker();this._encoder=n,n.addEventListener("message",this._handleEncoderMessage);var r=yield this._startRecording();return r?((e=this._onStart)==null||e.call(this),(t=this._onDuration)==null||t.call(this,this._duration),n.postMessage({command:"encode-init",config:babelHelpers.extends({},s,{originalSampleRate:this._audioContext.sampleRate})}),this._encoderNode.connect(this._audioContext.destination),!0):!1});function t(){return e.apply(this,arguments)}return t})(),a.stop=function(){var e,t;this._state!==u.STOPPED&&(this._state=u.STOPPED,(e=this._recordingAbortController)==null||e.abort(),this._audioContext.close&&this._audioContext.close(),this._monitorNode.disconnect(),this._encoderNode.disconnect(),(t=this._encoder)==null||t.postMessage({command:"encode-done"}))},a.pause=function(){var e,t;this._state===u.RECORDING&&(this._state=u.PAUSED,(e=this._recordingAbortController)==null||e.abort(),(t=this._onPause)==null||t.call(this))},a.resume=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e;switch(this._state){case u.RECORDING:return!0;case u.STOPPED:return!1;case u.INACTIVE:throw r("err")("Attempting to resume recording that hasn't started");case u.PAUSED:break}var t=yield this._startRecording();return t?((e=this._onResume)==null||e.call(this),!0):!1});function t(){return e.apply(this,arguments)}return t})(),a.getDuration=function(){return this._duration},a.getMonitorNode=function(){return this._monitorNode},a._encodeBuffers=function(t){var e;if(this._isFirstBuffer){this._isFirstBuffer=!1;return}if(this._state===u.RECORDING){for(var n=[],o=0;o<t.numberOfChannels;o++)n[o]=t.getChannelData(o);var a=r("WANullthrows")(this._encoder);a.postMessage({command:"encode",buffers:n}),this._duration+=t.duration,(e=this._onDuration)==null||e.call(this,this._duration)}},a._getNextRequestId=function(){return this._requestCount++,this._requestCount},a._startRecording=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){this._state=u.RECORDING,this._recordingAbortController=new AbortController;var e=yield p(this._createStream,this._audioContext,[this._encoderNode,this._monitorNode],this._recordingAbortController.signal);return e?!0:(this.stop(),!1)});function t(){return e.apply(this,arguments)}return t})(),a._storePage=function(t){var e;if(this._recordedPages.push(t),t[5]&4){var n,o;(n=this._handlePage)==null||n.call(this,t,!0);var a=r("WANullthrows")(this._encoder);a.removeEventListener("message",this._handleEncoderMessage),this._resolveCompleteRecordingPromise(d(this._recordedPages)),this._recordedPages=[],(o=this._onStop)==null||o.call(this);return}(e=this._handlePage)==null||e.call(this,t,!1)},a._handleFlushed=function(t){var e=r("WANullthrows")(this._pendingFlushResolvers.get(t));this._pendingFlushResolvers.delete(t),e(d(this._recordedPages))},a.getPartialRecording=function(){var t=this,o=this._getNextRequestId(),a=new(e||(e=n("Promise")))(function(e){t._pendingFlushResolvers.set(o,e)}),i=r("WANullthrows")(this._encoder);return i.postMessage({command:"flush",requestId:o}),a},a.getCompleteRecording=function(){return this._completeRecordingPromise},t})();function d(e){var t=e.reduce(function(e,t){return e+t.length},0),n=new Uint8Array(t),r=0;for(var o of e)n.set(o,r),r+=o.length;return new Blob([n],{type:"audio/ogg; codecs=opus"})}function m(){return!!(window.AudioContext&&o("WAGetUserMedia").getUserMedia)}function p(e,t,n,r){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r){var o=yield e(r);if(r.aborted||o==null)return!1;var a=t.createMediaStreamSource(o);return n.forEach(function(e){a.connect(e)}),r.addEventListener("abort",function(){o.getTracks().forEach(function(e){e.stop()}),a.disconnect()},{once:!0}),!0}),_.apply(this,arguments)}l.OpusRecorderState=u,l.OpusRecorder=c}),98);
__d("WAPttComposerRecorderPollableTimer",[],(function(t,n,r,o,a,i){var e=(function(){function e(){}var t=e.prototype;return t.start=function(){this.$1=Date.now()},t.stop=function(){this.$2=Date.now()},t.pause=function(){this.stop()},t.resume=function(){this.$1=Date.now()-this.getTime(),this.$2=null},t.getTime=function(){var e,t=this.$1;if(t==null)return 0;var n=(e=this.$2)!=null?e:Date.now();return n-t},e})();i.default=e}),66);
__d("WAStartAnimationLoop",[],(function(t,n,r,o,a,i){function e(e,t){var n=t!=null?t:{},r=n.delay,o=r===void 0?0:r,a,i,l,s=function(){i=!0,window.cancelAnimationFrame(a)},u=function(n){(l==null||n-l>=o)&&(e(n),l=n),!i&&(a=window.requestAnimationFrame(u))};return a=window.requestAnimationFrame(u),s}i.startAnimationLoop=e}),66);
__d("WAPttComposerWaveformRecorder",["WANullthrows","WAPttComposerRecorderPollableTimer","WAPttComposerScaleWaveform","WAStartAnimationLoop"],(function(t,n,r,o,a,i,l){var e=(function(){function e(e,t){var n=this;this.$2=new(r("WAPttComposerRecorderPollableTimer")),this.$3=[],this.$4=[],this.$5=0,this.$10=function(){n.$5=Math.max(n.$5,n.$11());var e=n.$3.length/n.$1,t=Math.floor((n.getDuration()-e)*n.$1);if(t!==0){for(var r=0;r<t;r++)n.$3.push(n.$5);n.$5=0}},this.$12=0,this.$7=s(e),e.connect(this.$7),this.$1=t}var t=e.prototype;return t.start=function(){this.$2.start(),this.$9()},t.stop=function(){var e;this.$2.stop(),(e=this.$6)==null||e.call(this)},t.pause=function(){var e;this.$2.pause(),(e=this.$6)==null||e.call(this)},t.resume=function(){this.$2.resume(),this.$9()},t.$9=function(){this.$6=o("WAStartAnimationLoop").startAnimationLoop(this.$10)},t.$11=function(){var e,t=r("WANullthrows")(this.$7);this.$8=(e=this.$8)!=null?e:new Uint8Array(t.frequencyBinCount);var n=this.$8;return t.getByteFrequencyData(n),Math.max.apply(Math,Array.from(n))/255},t.commitSamples=function(t){var e=Math.floor(t*this.$1),n=e-this.$4.length,o=this.$3.length-this.$12;if(!(n===0||o===0)){var a=this.$3.slice(this.$12,this.$3.length),i=r("WAPttComposerScaleWaveform")(a,n);for(var l of i)this.$4.push(l);this.$12=this.$3.length}},t.getSamples=function(){return this.$3},t.getDuration=function(){var e,t=(e=this.$2.getTime())!=null?e:0;return t/1e3},t.getCorrectedSamples=function(){return this.$4},e})();function s(e){var t=e.context.createAnalyser();return t.fftSize=32,t.smoothingTimeConstant=0,t.minDecibels=-60,t.maxDecibels=-10,t}l.default=e}),98);
__d("WAPttComposerRecorder",["WAPttComposerOpusRecorder","WAPttComposerWaveformRecorder","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e=(function(){function e(e){var t=this;this._handleOpusRecorderDuration=function(){t._waveformRecorder.commitSamples(t.getDuration()),t._onDuration==null||t._onDuration(t.getDuration())},this._onDuration=e.onDuration,this._opusRecorder=new(o("WAPttComposerOpusRecorder")).OpusRecorder({createStream:e.createStream,onDuration:this._handleOpusRecorderDuration,onPage:function(n,r){e.onPage==null||e.onPage(n,r)}}),this._waveformRecorder=new(r("WAPttComposerWaveformRecorder"))(this._opusRecorder.getMonitorNode(),e.waveformSampleRate)}var t=e.prototype;return t.start=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield this._opusRecorder.start();return e?(this._waveformRecorder.start(),!0):!1});function t(){return e.apply(this,arguments)}return t})(),t.stop=function(){this._opusRecorder.stop(),this._waveformRecorder.stop()},t.pause=function(){this._opusRecorder.pause(),this._waveformRecorder.pause()},t.resume=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield this._opusRecorder.resume();return e?(this._waveformRecorder.resume(),!0):!1});function t(){return e.apply(this,arguments)}return t})(),t.getDuration=function(){return this._opusRecorder.getDuration()},t.getPreciseDuration=function(){var e;return(e=this._waveformRecorder.getDuration())!=null?e:0},t.getLiveWaveformSamples=function(){return this._waveformRecorder.getSamples()},t.getCorrectedWaveformSamples=function(){return this._waveformRecorder.getCorrectedSamples()},t.getPartialRecording=function(){return this._opusRecorder.getPartialRecording()},t.getCompleteRecording=function(){return this._opusRecorder.getCompleteRecording()},e})();l.default=e}),98);
__d("MWPUseVoiceRecorderV2",["FBLogger","MAWAudioUtils","MWPAudioPlayerIcons.react","MWPAudioPlayerLabels","Promise","WAMaybeTranscodeOggOpusToWavForPlayback","WAPttComposerRecorder","asyncToGeneratorRuntime","clearTimeout","emptyFunction","err","getSafeQplErrorMessage","gkx","react","setTimeout","useIsMountedRef","usePrevious"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=p||(p=o("react")),f=p,g=f.useCallback,h=f.useEffect,y=f.useReducer,C=f.useRef,b=function(){return r("FBLogger")("wmi").tags(["audio"])};function v(e){switch(e.stage){case"Unopen":case"Recording":return!1;case"Recorded":case"Playing":return!0}}function S(e){switch(e.stage){case"Unopen":case"Recording":return!1;case"Recorded":case"Playing":return!0}}function R(e){switch(e.stage){case"Unopen":return 0;case"Recording":return e.duration;case"Recorded":case"Playing":return Math.max(e.duration-e.currentTime,0)}}function L(e){switch(e.stage){case"Unopen":return 0;case"Recording":return e.recordingTimeout;case"Recorded":case"Playing":return e.duration}}function E(e){switch(e.stage){case"Unopen":case"Recording":return;case"Recorded":case"Playing":return e.currentTime}}function k(e){switch(e.stage){case"Unopen":case"Recorded":return!1;case"Recording":case"Playing":return!0}}function I(e){return e.stage==="Recorded"?e.currentTime===0:!1}function T(e){switch(e.stage){case"Recording":return o("MWPAudioPlayerLabels").stopLabel;case"Unopen":case"Recorded":return o("MWPAudioPlayerLabels").playLabel;case"Playing":return o("MWPAudioPlayerLabels").pauseLabel}}function D(e,t){switch(e.stage){case"Recording":return _.jsx(o("MWPAudioPlayerIcons.react").StopIcon,{color:t});case"Unopen":case"Recorded":return _.jsx(o("MWPAudioPlayerIcons.react").PlayIcon,{color:t});case"Playing":return _.jsx(o("MWPAudioPlayerIcons.react").PauseIcon,{color:t})}}D.displayName=D.name+" [from "+i.id+"]";function x(e,t){switch(t.type){case"Start":return{duration:0,mediaStream:t.mediaStream,recordingTimeout:t.recordingTimeout,stage:"Recording"};case"Toggle":{switch(e.stage){case"Unopen":return e;case"Recording":return{currentTime:0,duration:e.duration,stage:"Recorded"};case"Recorded":return{currentTime:e.currentTime,duration:e.duration,stage:"Playing"};case"Playing":return{currentTime:e.currentTime,duration:e.duration,stage:"Recorded"}}break}case"UpdateDuration":{if(e.duration!=null&&t.duration<e.duration)return e;var n=t.duration;switch(e.stage){case"Unopen":return e;case"Recording":return{duration:n,mediaStream:e.mediaStream,recordingTimeout:e.recordingTimeout,stage:"Recording"};case"Recorded":return{currentTime:e.currentTime,duration:n,stage:"Recorded"};case"Playing":return{currentTime:e.currentTime,duration:n,stage:"Playing"}}break}case"UpdateTime":{var r=t.currentTime;switch(e.stage){case"Unopen":case"Recording":return e;case"Recorded":{var o=e.duration;return r===o?{currentTime:0,duration:o,stage:"Recorded"}:{currentTime:r,duration:o,stage:"Recorded"}}case"Playing":{var a=e.duration;return r===a?{currentTime:0,duration:a,stage:"Recorded"}:{currentTime:r,duration:a,stage:"Playing"}}}break}case"RecordingTimeout":return{currentTime:0,duration:t.recordingTimeout,stage:"Recorded"};case"Reset":return{stage:"Unopen"}}}var $={stage:"Unopen"};function P(t){var a=t.maxDuration,i=a===void 0?60:a,l=t.logClickStartRecording,p=l===void 0?r("emptyFunction"):l,_=t.logBrowserDenyAccess,f=_===void 0?r("emptyFunction"):_,v=t.createVoiceRecordQpl,S=y(x,$),R=S[0],L=S[1],E=r("useIsMountedRef")(),k=C(),I=C(),T=C(),D=C(),P=C(),N=C(r("emptyFunction")),M=g((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t[0],a=t[1],i=t[2];if(E.current){var l=new Date().getTime(),s=Math.round(a*1e3),u="audioclip-"+l+"-"+s+".ogg",c=new File([n],u,{type:"audio/ogg"}),d=URL.createObjectURL(yield o("WAMaybeTranscodeOggOpusToWavForPlayback").maybeTranscodeOggOpusToWavForPlayback(n));T.current=d;var m=new Audio(d);m.addEventListener("error",function(){var t,n;b().MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["audioElement error code: ",". message: ",""])),(t=m.error)==null?void 0:t.code,(n=m.error)==null?void 0:n.message)}),m.addEventListener("canplay",function(){var e;I.current=m;var t=m.duration;L({duration:t,type:"UpdateDuration"});var n=r("gkx")("20216")?{amplitudes:o("MAWAudioUtils").recomputeWaveform(i),sampling_freq:t>0?o("MAWAudioUtils").WAVEFORM_TARGET_SIZE/t:0}:{amplitudes:i,sampling_freq:o("MAWAudioUtils").WAVEFORM_SAMPLE_RATE},a={duration:t,file:c,waveformData:n};D.current=a,N.current(a),(e=P.current)==null||e.endSuccess()}),m.addEventListener("timeupdate",function(){var e,t=(e=I.current)==null?void 0:e.currentTime;t!=null&&L({currentTime:t,type:"UpdateTime"})}),m.addEventListener("durationchange",function(){var e,t=(e=I.current)==null?void 0:e.duration;t!=null&&!Number.isNaN(t)&&L({duration:t,type:"UpdateDuration"})})}});return function(e){return t.apply(this,arguments)}})(),[E]);h(function(){if(R.stage==="Recording"){p();var e=R.mediaStream;return(m||(m=n("Promise"))).resolve().then(function(){var t=new(r("WAPttComposerRecorder"))({createStream:function(){return(m||(m=n("Promise"))).resolve(e)},waveformSampleRate:o("MAWAudioUtils").WAVEFORM_SAMPLE_RATE});return k.current=t,t.start()}).then(function(e){if(e){b().INFO(s||(s=babelHelpers.taggedTemplateLiteralLoose(["PTT recording start successfully"])));return}return(m||(m=n("Promise"))).reject(r("err")("PTT recording start failed"))}).catch(function(e){var t;b().MUSTFIX(u||(u=babelHelpers.taggedTemplateLiteralLoose(["PTT recording start Error ",""])),e),(t=P.current)==null||t.endFail("start-error",{string:{failReason:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(e)}})}),function(){var e;(e=k.current)==null||e.stop()}}},[p,R.mediaStream,R.stage]);var w=r("usePrevious")(R);h(function(){if((w==null?void 0:w.stage)==="Recording"&&R.stage==="Recorded"){var e=k.current;if(e==null)return;e.stop(),(m||(m=n("Promise"))).all([e.getCompleteRecording(),e.getCorrectedWaveformSamples()]).then(function(t){var n=t[0],r=t[1],o=e.getDuration();return M([n,o,r])}).catch(function(e){var t;b().MUSTFIX(c||(c=babelHelpers.taggedTemplateLiteralLoose(["PTT recording stop Error ",""])),e),(t=P.current)==null||t.endFail("browser-deny-access",{string:{failReason:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(e)}})})}},[M,w==null?void 0:w.stage,R.stage]),h(function(){if(R.stage==="Recording"){var e=Date.now(),t,n=function(){var o=(Date.now()-e)/1e3;if(o>=i){L({recordingTimeout:i,type:"RecordingTimeout"});return}L({duration:o,type:"UpdateDuration"}),t=r("setTimeout")(n,1e3)};return t=r("setTimeout")(n,1e3),function(){t!=null&&r("clearTimeout")(t)}}},[i,R.stage]);var A=g(function(e){var t=v==null?void 0:v();P.current=t,t==null||t.start({startInfo:{isOpusRecorder:!0}}),L({mediaStream:e,recordingTimeout:i,type:"Start"})},[i,v]),F=g(function(){var e,t;(e=P.current)==null||e.endCancel(),L({type:"Reset"}),(t=I.current)==null||t.pause(),I.current=void 0,D.current=void 0;var n=T.current;n!=null&&(URL.revokeObjectURL(n),T.current=void 0)},[]),O=g(function(){var e=function(){L({maxDuration:i,type:"Toggle"})},t=I.current;if(t==null){e();return}switch(R.stage){case"Unopen":{e();break}case"Recording":{var n;(n=P.current)==null||n.addPoint("stop-recording"),e();break}case"Recorded":{var r;(r=P.current)==null||r.addPoint("play-audio"),t.play().then(e).catch(function(e){var t;b().MUSTFIX(d||(d=babelHelpers.taggedTemplateLiteralLoose(["PTT recording play Error ",""])),e),(t=P.current)==null||t.endFail("browser-deny-access",{string:{failReason:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(e)}}),f()});break}case"Playing":{var a;(a=P.current)==null||a.addPoint("pause-playing"),t.pause(),e();break}}},[f,R.stage,i]),B=g(function(){return new(m||(m=n("Promise")))(function(e){var t=D.current;if(t!=null)return e(t);if(N.current=e,R.stage==="Recording")return O()})},[R,O]);return{audioEl:I,getVoiceClip:B,reset:F,start:A,state:R,toggle:O}}l.showScreenReaderLabel=v,l.hasScrubber=S,l.getTimerTime=R,l.getDuration=L,l.getCurrentTime=E,l.isProgressing=k,l.isCompleted=I,l.getPlaybackLabel=T,l.getPlaybackIcon=D,l.useVoiceRecorder=P}),98);